"use strict";(()=>{var e={};e.id=3473,e.ids=[3473],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},73292:e=>{e.exports=require("fs/promises")},41808:e=>{e.exports=require("net")},71017:e=>{e.exports=require("path")},77282:e=>{e.exports=require("process")},12781:e=>{e.exports=require("stream")},71576:e=>{e.exports=require("string_decoder")},39512:e=>{e.exports=require("timers")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},84399:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>g,patchFetch:()=>q,requestAsyncStorage:()=>x,routeModule:()=>m,serverHooks:()=>j,staticGenerationAsyncStorage:()=>f});var r={};t.r(r),t.d(r,{DELETE:()=>d,POST:()=>l});var a=t(49303),o=t(88716),n=t(60670),i=t(87070),p=t(73292),u=t(71017),c=t(8852);async function l(e){try{let s=await e.formData(),t=s.get("file"),r=s.get("projectId");if(!t)return i.NextResponse.json({success:!1,message:"No file provided"},{status:400});if(!r)return i.NextResponse.json({success:!1,message:"Project ID is required"},{status:400});let a=t.name.toLowerCase().split(".").pop(),o=["ppt","pptx"].includes(a||"");if(!["application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"].includes(t.type)&&!o)return i.NextResponse.json({success:!1,message:"Only PowerPoint files (.ppt, .pptx) are allowed"},{status:400});if(t.size>52428800)return i.NextResponse.json({success:!1,message:"File size too large. Maximum size is 50MB"},{status:400});let n=(0,u.join)(process.cwd(),"public","presentations");try{await (0,p.access)(n)}catch{try{await (0,p.mkdir)(n,{recursive:!0})}catch(e){return i.NextResponse.json({success:!1,message:"Failed to create upload directory"},{status:500})}}let l=Date.now(),d=t.name.replace(/[^a-zA-Z0-9.-]/g,"_"),m=`project-${r}-${l}-${d}`,x=(0,u.join)(n,m);try{let e=await t.arrayBuffer(),s=Buffer.from(e);await (0,p.writeFile)(x,s)}catch(e){return i.NextResponse.json({success:!1,message:"Failed to save file to disk"},{status:500})}let f=`/presentations/${m}`;try{if(!await c.uu.updateProject(parseInt(r),{presentation_file:f}))return i.NextResponse.json({success:!1,message:"Project not found or failed to update"},{status:404});return i.NextResponse.json({success:!0,data:{filename:m,originalName:t.name,path:f,size:t.size,projectId:parseInt(r)},message:"PPTX file uploaded successfully"},{status:201})}catch(e){return i.NextResponse.json({success:!1,message:"Failed to update project in database"},{status:500})}}catch(e){return i.NextResponse.json({success:!1,message:"Internal server error during file upload"},{status:500})}}async function d(e){try{let{searchParams:s}=new URL(e.url),t=s.get("projectId");if(!t)return i.NextResponse.json({success:!1,message:"Project ID is required"},{status:400});if(!await c.uu.updateProject(parseInt(t),{presentation_file:null}))return i.NextResponse.json({success:!1,message:"Project not found"},{status:404});return i.NextResponse.json({success:!0,message:"PPTX file removed from project successfully"})}catch(e){return i.NextResponse.json({success:!1,message:"Failed to remove PPTX file"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/projects/upload-pptx/route",pathname:"/api/admin/projects/upload-pptx",filename:"route",bundlePath:"app/api/admin/projects/upload-pptx/route"},resolvedPagePath:"C:\\Users\\Berlin\\Desktop\\sssq-main\\sssq-main\\app\\api\\admin\\projects\\upload-pptx\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:x,staticGenerationAsyncStorage:f,serverHooks:j}=m,g="/api/admin/projects/upload-pptx/route";function q(){return(0,n.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:f})}}};var s=require("../../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[8948,5972,3785,5802],()=>t(84399));module.exports=r})();