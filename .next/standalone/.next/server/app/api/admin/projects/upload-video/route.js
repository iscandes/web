"use strict";(()=>{var e={};e.id=8703,e.ids=[8703],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},73292:e=>{e.exports=require("fs/promises")},41808:e=>{e.exports=require("net")},71017:e=>{e.exports=require("path")},77282:e=>{e.exports=require("process")},12781:e=>{e.exports=require("stream")},71576:e=>{e.exports=require("string_decoder")},39512:e=>{e.exports=require("timers")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},60024:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>j,patchFetch:()=>g,requestAsyncStorage:()=>x,routeModule:()=>f,serverHooks:()=>_,staticGenerationAsyncStorage:()=>E});var i={};r.r(i),r.d(i,{DELETE:()=>m,POST:()=>c});var s=r(49303),a=r(88716),o=r(60670),u=r(87070),n=r(73292),p=r(71017),d=r.n(p),l=r(8852);async function c(e){try{let t=await e.formData(),r=t.get("file"),i=t.get("projectId"),s=t.get("mediaType")||"auto";if(!r||!i)return u.NextResponse.json({error:"File and project ID are required"},{status:400});let a=[".mp4",".webm",".mov",".avi",".png",".jpg",".jpeg",".gif",".webp"],o=d().extname(r.name).toLowerCase();if(!a.includes(o))return u.NextResponse.json({error:`File type ${o} not supported. Allowed types: ${a.join(", ")}`},{status:400});if(r.size>262144e3)return u.NextResponse.json({error:"File size too large. Maximum size is 250MB"},{status:400});let p=s;"auto"===s&&(p=[".mp4",".webm",".mov",".avi"].includes(o)?"video":r.name.toLowerCase().includes("animation")||r.name.toLowerCase().includes("sequence")||r.name.toLowerCase().includes("frame")?"animation":[".png",".jpg",".jpeg",".gif",".webp"].includes(o)?"image":"video");let c=d().join(process.cwd(),"public","uploads","projects",i);try{await (0,n.mkdir)(c,{recursive:!0})}catch(e){}let m=Date.now(),f=r.name.replace(/[^a-zA-Z0-9.-]/g,"_"),x=`${m}_${f}`,E=d().join(c,x),_=`/uploads/projects/${i}/${x}`,j=await r.arrayBuffer(),g=Buffer.from(j);await (0,n.writeFile)(E,g);let y=`
      INSERT INTO project_media (project_id, file_name, file_path, file_size, media_type, file_extension, upload_date)
      VALUES (?, ?, ?, ?, ?, ?, NOW())
      ON DUPLICATE KEY UPDATE
      file_path = VALUES(file_path),
      file_size = VALUES(file_size),
      media_type = VALUES(media_type),
      file_extension = VALUES(file_extension),
      upload_date = NOW()
    `;await l.uu.executeQuery(y,[i,x,_,r.size,p,o]);let w=await l.uu.executeQuery("SELECT media_files, featured_video FROM projects WHERE id = ?",[i]),v=[];if(w.length>0&&w[0].media_files)try{v=JSON.parse(w[0].media_files)}catch(e){v=[]}let h={id:Date.now(),name:r.name,url:_,file_path:_,type:p,media_type:p,file_size:r.size,file_extension:o,upload_date:new Date().toISOString()};return v.push(h),await l.uu.executeQuery("UPDATE projects SET media_files = ? WHERE id = ?",[JSON.stringify(v),i]),"video"===p&&await l.uu.executeQuery("UPDATE projects SET featured_video = ? WHERE id = ?",[_,i]),u.NextResponse.json({success:!0,message:`${p.charAt(0).toUpperCase()+p.slice(1)} uploaded successfully`,data:{fileName:x,filePath:_,fileSize:r.size,mediaType:p,fileExtension:o,uploadDate:new Date().toISOString()}})}catch(e){return u.NextResponse.json({error:"Failed to upload file",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function m(e){try{let{searchParams:t}=new URL(e.url),r=t.get("projectId"),i=t.get("fileName");if(!r||!i)return u.NextResponse.json({error:"Project ID and file name are required"},{status:400});await l.uu.executeQuery("DELETE FROM project_media WHERE project_id = ? AND file_name = ?",[r,i]);let s=await l.uu.executeQuery("SELECT media_files FROM projects WHERE id = ?",[r]);if(s.length>0&&s[0].media_files)try{let e=JSON.parse(s[0].media_files);e=e.filter(e=>!e.url.includes(i)),await l.uu.executeQuery("UPDATE projects SET media_files = ? WHERE id = ?",[JSON.stringify(e),r])}catch(e){}return u.NextResponse.json({success:!0,message:"Media file removed successfully"})}catch(e){return u.NextResponse.json({error:"Failed to remove file"},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/projects/upload-video/route",pathname:"/api/admin/projects/upload-video",filename:"route",bundlePath:"app/api/admin/projects/upload-video/route"},resolvedPagePath:"C:\\Users\\Berlin\\Desktop\\sssq-main\\sssq-main\\app\\api\\admin\\projects\\upload-video\\route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:x,staticGenerationAsyncStorage:E,serverHooks:_}=f,j="/api/admin/projects/upload-video/route";function g(){return(0,o.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:E})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[8948,5972,3785,5802],()=>r(60024));module.exports=i})();