"use strict";(()=>{var e={};e.id=744,e.ids=[744],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},41808:e=>{e.exports=require("net")},77282:e=>{e.exports=require("process")},12781:e=>{e.exports=require("stream")},71576:e=>{e.exports=require("string_decoder")},39512:e=>{e.exports=require("timers")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},94566:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>f,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>k,staticGenerationAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{GET:()=>_,POST:()=>m});var a=r(49303),o=r(88716),n=r(60670),i=r(87070),p=r(8852);async function u(){try{let e=await (0,p.N8)(),[t]=await e.execute(`
      SELECT * FROM ai_api_settings ORDER BY created_at DESC LIMIT 1
    `),r=t[0];if(!r)throw Error("No AI API settings found");return{deepseek_api_key:r.deepseek_api_key,deepseek_model:r.deepseek_model||"deepseek-chat",deepseek_max_tokens:r.deepseek_max_tokens||1e3,deepseek_temperature:r.deepseek_temperature||.7,system_prompt:r.system_prompt||"You are a helpful real estate assistant.",property_suggestions_enabled:!!r.property_suggestions_enabled,property_suggestions_count:r.property_suggestions_count||3}}catch(e){throw e}}async function c(e,t){try{let r=await fetch("https://api.deepseek.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.deepseek_api_key}`},body:JSON.stringify({model:e.deepseek_model,messages:[{role:"system",content:e.system_prompt},{role:"user",content:t}],max_tokens:e.deepseek_max_tokens,temperature:e.deepseek_temperature,stream:!1})});if(!r.ok)throw await r.text(),Error(`DeepSeek API error: ${r.status}`);let s=await r.json();if(!s.choices||!s.choices[0]||!s.choices[0].message)throw Error("Invalid response format from DeepSeek API");return s.choices[0].message.content}catch(e){throw e}}async function d(e=3){try{let t=await (0,p.N8)(),[r]=await t.execute(`
      SELECT name, location, price, bedrooms, bathrooms, area, description, image
      FROM projects 
      WHERE status = 'Available' 
      ORDER BY RAND() 
      LIMIT ?
    `,[e]);return r}catch(e){return[]}}async function l(e,t,r,s){try{let a=await (0,p.N8)(),o=`chat_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;await a.execute(`
      INSERT INTO chat_messages (session_id, message, response, response_time, user_ip)
      VALUES (?, ?, ?, ?, ?)
    `,[o,e,t,r,s||"unknown"])}catch(e){}}async function m(e){let t=Date.now();try{let{message:r}=await e.json();if(!r||"string"!=typeof r||0===r.trim().length)return i.NextResponse.json({error:"Message is required"},{status:400});let s=await u();if(!s.deepseek_api_key)return i.NextResponse.json({error:"DeepSeek API key not configured"},{status:500});let a=r,o=[];if(s.property_suggestions_enabled&&(o=await d(s.property_suggestions_count)).length>0){let e=o.map(e=>`${e.name} in ${e.location} - ${e.price} (${e.bedrooms}BR/${e.bathrooms}BA, ${e.area})`).join("\n");a=`${r}

Available Properties:
${e}`}let n=await c(s,a),p=Date.now()-t,m=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown";return l(r,n,p,m),i.NextResponse.json({response:n,responseTime:p,suggestions:s.property_suggestions_enabled?o:[]})}catch(r){let e=Date.now()-t;return i.NextResponse.json({response:"I apologize, but I'm experiencing technical difficulties at the moment. Please try again later for assistance with your real estate needs.",responseTime:e,error:"AI service temporarily unavailable"})}}async function _(){try{let e=await u();return i.NextResponse.json({status:"ok",configured:!!e.deepseek_api_key,model:e.deepseek_model,timestamp:new Date().toISOString()})}catch(e){return i.NextResponse.json({status:"error",error:"Service unavailable"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"C:\\Users\\Berlin\\Desktop\\sssq-main\\sssq-main\\app\\api\\chat\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:y,serverHooks:k}=h,x="/api/chat/route";function f(){return(0,n.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:y})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,3785,5802],()=>r(94566));module.exports=s})();